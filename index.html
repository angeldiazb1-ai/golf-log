<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b2f26" />
  <title>Golf Log – Práctica</title>

  <link rel="manifest" href="manifest.webmanifest?v=7000">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png?v=7000">
  <link rel="icon" href="icons/icon-192.png?v=7000">

  <style>
    :root{
      --bg:#07271f;
      --panel:#0b3329;
      --text:#eaf7f3;
      --muted:#b7d7cd;
      --accent:#1fa16b;
      --accent2:#c6a11a;
      --btn:#1fa16b;
      --btnText:#052218;
      --shadow: 0 10px 22px rgba(0,0,0,.28);
      --radius: 22px;
    }
    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    html,body{height:100%;}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 700px at 50% -200px, #0f4a3b 0%, var(--bg) 55%, #041b15 100%);
      color: var(--text);
      padding: 18px 14px 28px;
    }
    header{
      text-align:center;
      padding: 10px 8px 16px;
      color: var(--text);
      font-weight: 800;
      font-size: 26px;
      letter-spacing:.2px;
    }
    header .sub{display:block; font-size:12px; color: var(--muted); font-weight:600; margin-top:6px}
    .wrap{max-width:520px; margin:0 auto;}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05) 0%, rgba(255,255,255,.02) 100%), var(--panel);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      margin-bottom: 14px;
    }
    label{
      display:block;
      font-size: 18px;
      font-weight: 800;
      margin: 10px 2px 8px;
      color: var(--text);
    }
    select,input{
      width:100%;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.45);
      color: var(--text);
      padding: 14px 14px;
      font-size: 20px;
      outline:none;
    }
    input::placeholder{color: rgba(234,247,243,.5);}
    .dirGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 8px;
    }
    .btn{
      border:0;
      border-radius: 18px;
      padding: 16px 14px;
      font-size: 20px;
      font-weight: 900;
      color: var(--btnText);
      background: var(--btn);
      box-shadow: 0 10px 18px rgba(0,0,0,.22);
      cursor:pointer;
      user-select:none;
      touch-action: manipulation;
    }
    .btn.secondary{background: rgba(255,255,255,.10); color: var(--text); border: 1px solid rgba(255,255,255,.14);}
    .btn.dir{background: rgba(255,255,255,.08); color: var(--text); border: 1px solid rgba(255,255,255,.12);}
    .btn.dir.active{background: var(--accent); color: var(--btnText); border-color: rgba(0,0,0,.0);}
    .btn.warn{background: var(--accent2); color:#1f1702;}
    .actions{display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 14px;}
    .pill{
      display:inline-flex;
      gap:10px;
      align-items:center;
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 14px;
      font-weight: 800;
      color: var(--muted);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      margin-top: 10px;
    }
    .pill strong{color: var(--text); font-weight: 900;}
    .mini{
      font-size:12px;
      color: rgba(234,247,243,.65);
      margin-top: 8px;
    }
    .last{
      margin-top: 14px;
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.08);
      color: var(--muted);
      font-weight: 700;
    }
    .last strong{color: var(--text);}
    footer{
      text-align:center;
      color: rgba(234,247,243,.55);
      font-size: 12px;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>⛳️ Golf Log – Práctica <span class="sub">B7.0 base estable iOS (sin SW)</span></header>

    <section class="card" id="app">
      <label for="palo">Palo</label>
      <select id="palo">
        <option value="">Selecciona</option>
        <option>Driver</option>
        <option>3W</option>
        <option>5W</option>
        <option>3H</option>
        <option>4H</option>
        <option>4i</option>
        <option>5i</option>
        <option>6i</option>
        <option>7i</option>
        <option>8i</option>
        <option>9i</option>
        <option>PW</option>
        <option>SW</option>
        <option>LW</option>
        <option>Putter</option>
      </select>

      <label>Dirección</label>
      <div class="dirGrid" id="dirGrid">
        <button class="btn dir" data-dir="Izq" type="button">Izq</button>
        <button class="btn dir active" data-dir="Centro" type="button">Centro</button>
        <button class="btn dir" data-dir="Der" type="button">Der</button>
        <button class="btn dir secondary" data-dir="—" type="button">—</button>
      </div>

      <label for="dist">Distancia (m)</label>
      <input id="dist" inputmode="numeric" pattern="[0-9]*" placeholder="Ej. 183" />

      <div class="actions">
        <button class="btn" id="guardarBtn" type="button">Guardar golpe</button>
        <button class="btn warn" id="deshacerBtn" type="button">Deshacer</button>
      </div>

      <div class="pill"><span>JS:</span> <strong id="jsStatus">activo ✓</strong></div>

      <div class="last" id="lastBox">Último: <strong id="lastText">—</strong></div>
      <div class="mini">Se guarda localmente en el iPhone (localStorage). Sin Service Worker para evitar caches viejos.</div>
    </section>

    <footer>© Golf Log</footer>
  </div>

<script>
(() => {
  "use strict";

  const KEY = "golfLog_b70_shots";
  const $ = (id) => document.getElementById(id);

  const paloEl = $("palo");
  const distEl = $("dist");
  const lastText = $("lastText");
  const dirGrid = $("dirGrid");

  let dirActual = "Centro";
  let shots = [];

  function load() {
    try {
      const raw = localStorage.getItem(KEY);
      shots = raw ? JSON.parse(raw) : [];
      if (!Array.isArray(shots)) shots = [];
    } catch {
      shots = [];
    }
    renderLast();
  }

  function save() {
    localStorage.setItem(KEY, JSON.stringify(shots));
  }

  function renderLast() {
    if (!shots.length) {
      lastText.textContent = "—";
      return;
    }
    const s = shots[shots.length - 1];
    lastText.textContent = `${s.palo || "—"} – ${s.dist || "—"} m – ${s.dir || "—"}`;
  }

  function setDir(dir) {
    dirActual = dir;
    for (const btn of dirGrid.querySelectorAll("button[data-dir]")) {
      btn.classList.toggle("active", btn.dataset.dir === dir);
    }
  }

  function guardar() {
    const palo = (paloEl.value || "").trim();
    const dist = (distEl.value || "").trim();
    const distNum = Number(dist);

    if (!palo) { alert("Selecciona un palo."); return; }
    if (!dist || !Number.isFinite(distNum) || distNum <= 0) { alert("Ingresa una distancia válida."); return; }

    const shot = { ts: Date.now(), palo, dist: Math.round(distNum), dir: dirActual };
    shots.push(shot);
    save();
    renderLast();

    distEl.value = "";
    distEl.focus();
  }

  function deshacer() {
    if (!shots.length) { alert("No hay golpes para deshacer."); return; }
    shots.pop();
    save();
    renderLast();
  }

  // iOS-safe: delegación + touchstart
  function onAction(e) {
    const btn = e.target && e.target.closest ? e.target.closest("button") : null;
    if (!btn) return;

    const dir = btn.dataset && btn.dataset.dir;
    if (dir) { setDir(dir); return; }

    if (btn.id === "guardarBtn") { guardar(); return; }
    if (btn.id === "deshacerBtn") { deshacer(); return; }
  }

  document.addEventListener("click", onAction, true);
  document.addEventListener("touchstart", onAction, true);

  load();
  setDir("Centro");
})();
</script>
</body>
</html>
