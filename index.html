<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Golf Log</title>

<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0f5132">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
:root{
  --bg:#061d14;
  --card:#123a2a;
  --soft:#1b4d38;
  --accent:#4ade80;
  --warn:#facc15;
  --danger:#ef4444;
  --text:#e6f4ec;
  --muted:#b7d6c7;
  --radius:18px;
}
*{box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;}
html,body{margin:0;padding:0;background:radial-gradient(circle at top,#0f5132,var(--bg));color:var(--text);overflow-x:hidden;}
h1{font-size:36px;margin:16px 0;}
h2{margin:0 0 12px;font-size:20px;}
.card{background:linear-gradient(180deg,var(--soft),var(--card));border-radius:var(--radius);padding:18px;margin-bottom:18px;}
.segmented{display:flex;flex-wrap:wrap;gap:10px;}
.seg-btn{flex:1;min-width:90px;padding:12px;border-radius:14px;border:none;background:#1e5b43;color:var(--text);font-size:17px;}
.seg-btn.active{background:var(--accent);color:#062317;font-weight:700;}
input,select{width:100%;padding:14px;font-size:18px;border-radius:14px;border:2px solid #2e7d5b;background:#0d2f22;color:var(--text);}
.row{display:flex;gap:12px;margin-top:14px;}
.action{flex:1;padding:14px;font-size:18px;border-radius:14px;border:none;font-weight:700;}
#guardarBtn{background:var(--accent);color:#062317;}
#deshacerBtn{background:var(--warn);color:#3a2a00;}
.pill{display:flex;justify-content:space-between;align-items:center;background:#0d2f22;border-radius:999px;padding:10px 14px;font-size:14px;margin-top:10px;}
.badge{min-width:80px;padding:8px 12px;border-radius:999px;font-weight:700;text-align:center;}
.ok{background:var(--accent);color:#062317;}
.bad{background:var(--danger);}
.neutral{background:#64748b;}
.tableWrap{width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch;}
table{min-width:620px;width:100%;border-collapse:collapse;font-size:14px;}
th,td{padding:8px;border-bottom:1px solid #1f5b3f;text-align:center;white-space:nowrap;}
footer{text-align:center;font-size:12px;color:var(--muted);margin:20px 0;}
</style>
</head>

<body>
<h1>Golf Log</h1>

<section class="card">
  <div class="segmented" id="modoButtons">
    <button class="seg-btn active" data-modo="range">Range</button>
    <button class="seg-btn" data-modo="zona">Zona</button>
    <button class="seg-btn" data-modo="evaluacion">Evaluación</button>
    <button class="seg-btn" data-modo="objetivo">Objetivo</button>
  </div>
</section>

<section class="card">
<h2>Palo</h2>
<div class="segmented" id="paloButtons">
  <button class="seg-btn active">Driver</button>
  <button class="seg-btn">H3</button>
  <button class="seg-btn">H4</button>
  <button class="seg-btn">5i</button>
  <button class="seg-btn">6i</button>
  <button class="seg-btn">7i</button>
  <button class="seg-btn">8i</button>
  <button class="seg-btn">9i</button>
  <button class="seg-btn">PW</button>
  <button class="seg-btn">SW56</button>
  <button class="seg-btn">Putter</button>
</div>
</section>

<section class="card" id="zonaPanel" style="display:none;">
<h2>Zona</h2>
<div class="muted">Rango fijo 0–300 m</div>
<select id="zonaSelect"></select>
<div class="pill"><span>Zona:</span><strong id="zonaActual">—</strong></div>
</section>

<section class="card">
<h2>Dirección</h2>
<div class="segmented" id="direccionButtons">
  <button class="seg-btn">Izq</button>
  <button class="seg-btn active">Centro</button>
  <button class="seg-btn">Der</button>
</div>
</section>

<section class="card">
<h2>Distancia (m)</h2>
<input id="distancia" inputmode="numeric" placeholder="Ej. 183">
<div class="row">
  <button id="guardarBtn" class="action">Guardar golpe</button>
  <button id="deshacerBtn" class="action">Deshacer</button>
</div>
<div class="pill" id="ultimoInfo">Último: —</div>
</section>

<section class="card">
<h2>Historial</h2>
<div class="tableWrap">
<table>
<thead>
<tr><th>#</th><th>Modo</th><th>Palo</th><th>Dir</th><th>m</th><th>Eval</th></tr>
</thead>
<tbody id="history"></tbody>
</table>
</div>
</section>

<footer>Golf Log · B2.1 (fix palo activo) · PWA</footer>

<script>
const STORAGE="golf-log-data";
let state=JSON.parse(localStorage.getItem(STORAGE))||{
  modo:"range",palo:"Driver",dir:"Centro",zonaKey:null,shots:[],sessionId:1
};
function save(){localStorage.setItem(STORAGE,JSON.stringify(state));}

function syncPaloFromUI(){
  const active=document.querySelector("#paloButtons .seg-btn.active");
  if(active){ state.palo=active.textContent.trim(); }
}

document.querySelectorAll("#modoButtons .seg-btn").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll("#modoButtons .seg-btn").forEach(x=>x.classList.remove("active"));
    b.classList.add("active");
    state.modo=b.dataset.modo;
    zonaPanel.style.display=state.modo==="zona"?"block":"none";
    save();render();
  };
});

function group(sel,cb){
  document.querySelectorAll(sel).forEach(b=>{
    b.onclick=()=>{
      document.querySelectorAll(sel).forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      cb(b.textContent.trim());
    };
  });
}
group("#paloButtons .seg-btn",v=>state.palo=v);
group("#direccionButtons .seg-btn",v=>state.dir=v);

const zonaSelect=document.getElementById("zonaSelect");
const zonaActual=document.getElementById("zonaActual");

function zonesFixed(step=15,max=300){
  const z=[];let n=1;
  for(let s=0;s<max;s+=step){
    z.push({key:`Z${n}`,min:s,max:Math.min(max,s+step),label:`Z${n}: ${s}–${Math.min(max,s+step)} m`});
    n++;
  }
  return z;
}
function updateZona(){
  const zs=zonesFixed();
  zonaSelect.innerHTML=`<option value="">Selecciona zona…</option>`+
    zs.map(z=>`<option value="${z.key}" ${state.zonaKey===z.key?"selected":""}>${z.label}</option>`).join("");
  const z=zs.find(x=>x.key===state.zonaKey);
  zonaActual.textContent=z?z.label:"—";
}
zonaSelect.onchange=e=>{state.zonaKey=e.target.value||null;save();render();};

function evalZona(m){
  const z=zonesFixed().find(x=>x.key===state.zonaKey);
  if(!z)return{l:"—",c:"neutral"};
  if(m<z.min)return{l:"Corto",c:"bad"};
  if(m>z.max)return{l:"Largo",c:"bad"};
  return{l:"OK",c:"ok"};
}

guardarBtn.onclick=()=>{
  syncPaloFromUI();
  const m=Number(distancia.value); if(!m) return;
  const e=state.modo==="zona"?evalZona(m):{l:"—",c:"neutral"};
  state.shots.push({modo:state.modo,palo:state.palo,dir:state.dir,m,eval:e,sessionId:state.sessionId});
  distancia.value="";
  save();render();
};
deshacerBtn.onclick=()=>{
  for(let i=state.shots.length-1;i>=0;i--){
    if(state.shots[i].sessionId===state.sessionId){
      state.shots.splice(i,1);break;
    }
  }
  save();render();
};

function render(){
  updateZona();
  const h=document.getElementById("history");h.innerHTML="";
  const shots=state.shots.filter(s=>s.sessionId===state.sessionId);
  shots.slice().reverse().forEach((s,i)=>{
    h.innerHTML+=`<tr>
      <td>${shots.length-i}</td><td>${s.modo}</td><td>${s.palo}</td>
      <td>${s.dir}</td><td>${s.m}</td>
      <td><span class="badge ${s.eval.c}">${s.eval.l}</span></td>
    </tr>`;
  });
  if(shots.length){
    const u=shots[shots.length-1];
    ultimoInfo.innerHTML=`Último: ${u.m} m → <span class="badge ${u.eval.c}">${u.eval.l}</span>`;
  }
}
render();

if("serviceWorker" in navigator){ navigator.serviceWorker.register("./sw.js"); }
</script>
</body>
</html>
