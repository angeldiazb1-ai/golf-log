<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Golf Log</title>

  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#0b3d2e">

  <style>
    :root { color-scheme: dark; }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #0b3d2e;
      color: #ffffff;
      -webkit-text-size-adjust: 100%;
    }

    header {
      padding: 12px;
      text-align: center;
      background: #06291f;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    main {
      padding: 12px;
      position: relative;
      z-index: 1;
    }

    button {
      width: 100%;
      padding: 14px;
      margin: 6px 0;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #1fa36a;
      color: #fff;
      cursor: pointer;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }
    button:active { transform: translateY(1px); }

    select, input {
      width: 100%;
      padding: 12px;
      margin: 6px 0;
      font-size: 16px;
      border-radius: 6px;
      border: none;
    }

    .card {
      background: #0f4d3a;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 10px;
    }

    h3 { margin: 0 0 8px 0; font-size: 18px; }

    /* Debug visible: confirma que el JS corrió */
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.12);
      font-size: 12px;
      margin-top: 8px;
    }
  </style>
</head>

<body>
  <header>⛳ Golf Log – Práctica</header>

  <main>
    <div class="card">
      <label for="club">Palo</label>
      <select id="club">
        <option value="">Selecciona</option>
        <option>Driver</option>
        <option>3W</option>
        <option>5W</option>
        <option>4I</option>
        <option>5I</option>
        <option>6I</option>
        <option>7I</option>
        <option>8I</option>
        <option>9I</option>
        <option>PW</option>
        <option>SW</option>
      </select>

      <label for="distance">Distancia (m)</label>
      <input type="number" id="distance" inputmode="numeric" />

      <label for="direction">Dirección</label>
      <select id="direction">
        <option>Centro</option>
        <option>Izquierda</option>
        <option>Derecha</option>
      </select>

      <button id="btnSave" type="button">Guardar tiro</button>
      <div id="jsBadge" class="badge" aria-live="polite">JS: esperando…</div>
    </div>

    <div class="card">
      <h3>Histórico</h3>
      <div id="log"></div>
      <button id="btnClear" type="button">Borrar histórico</button>
    </div>
  </main>

  <script>
    (function () {
      const KEY = 'golf-log-shots';

      const $ = (id) => document.getElementById(id);

      function loadShots() {
        try { return JSON.parse(localStorage.getItem(KEY) || '[]'); }
        catch { return []; }
      }

      function saveShots(data) {
        localStorage.setItem(KEY, JSON.stringify(data));
      }

      function render() {
        const shots = loadShots();
        const log = $('log');
        log.innerHTML = shots.map(s =>
          `<div>${s.club} – ${s.distance} m – ${s.direction}</div>`
        ).join('') || '<div>Sin registros.</div>';
      }

      function saveShot() {
        const club = $('club').value;
        const distance = $('distance').value;
        const direction = $('direction').value;

        if (!club || !distance) {
          alert('Completa los datos');
          return;
        }

        const shots = loadShots();
        shots.push({
          club,
          distance: Number(distance),
          direction,
          date: new Date().toISOString()
        });

        saveShots(shots);
        $('distance').value = '';
        render();
      }

      function clearShots() {
        if (!confirm('¿Borrar todo el histórico?')) return;
        localStorage.removeItem(KEY);
        render();
      }

      // ✅ Bind robusto (evita fallas por inline handlers)
      window.addEventListener('DOMContentLoaded', () => {
        $('btnSave').addEventListener('click', saveShot, { passive: true });
        $('btnClear').addEventListener('click', clearShots, { passive: true });
        $('jsBadge').textContent = 'JS: activo ✓';
        render();
      });

      // SW (registro simple)
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js');
        });
      }
    })();
  </script>
</body>
</html>
