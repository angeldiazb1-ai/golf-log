<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b3a2a" />
  <title>Golf Log – Práctica</title>

  <!-- No Service Worker (B7 base estable) -->

  <style>
    :root{
      --bg:#062e22;
      --card:#0b3a2a;
      --card2:#0a3426;
      --txt:#e9fff6;
      --muted:rgba(233,255,246,.75);
      --btn:#1f9d64;
      --danger:#c43b3b;
      --warn:#b08b1a;
      --chip:#103f2f;
      --border:rgba(233,255,246,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.25);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 900px at 50% -200px, #0f5b41 0%, var(--bg) 60%);
      color:var(--txt);
      -webkit-font-smoothing:antialiased;
      line-height:1.25;
    }
    .wrap{max-width:820px;margin:0 auto;padding:18px 16px 28px}
    header{
      position:sticky;top:0;z-index:20;
      padding:10px 0 14px;
      backdrop-filter:saturate(180%) blur(12px);
      background:linear-gradient(to bottom, rgba(6,46,34,.92), rgba(6,46,34,.55));
      border-bottom:1px solid rgba(233,255,246,.06);
    }
    .title{
      display:flex;align-items:center;gap:10px;
      font-weight:800;font-size:22px;letter-spacing:.2px;
      padding:8px 6px;
    }
    .title .emoji{font-size:22px}
    .grid{display:grid;gap:14px;margin-top:14px}
    .card{
      background:linear-gradient(180deg, rgba(11,58,42,.92), rgba(10,52,38,.92));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }
    .card h2{margin:2px 0 12px;font-size:18px}
    label{display:block;font-size:14px;color:var(--muted);margin:10px 0 8px}
    select,input{
      width:100%;
      font-size:18px;
      padding:14px 14px;
      border-radius:14px;
      border:1px solid rgba(233,255,246,.12);
      background:rgba(0,0,0,.35);
      color:var(--txt);
      outline:none;
    }
    input::placeholder{color:rgba(233,255,246,.35)}
    .row{display:grid;gap:12px}
    @media(min-width:720px){ .row{grid-template-columns:1fr 1fr} }
    .seg{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:10px;
      margin-top:6px;
    }
    .seg button{
      padding:14px 12px;
      border-radius:16px;
      border:1px solid rgba(233,255,246,.12);
      background:rgba(0,0,0,.22);
      color:rgba(233,255,246,.85);
      font-size:18px;
      font-weight:700;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .seg button.active{
      background:rgba(31,157,100,.92);
      border-color:rgba(31,157,100,.95);
      color:#062e22;
    }
    .actions{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-top:14px;
    }
    .btn{
      padding:14px 14px;
      border-radius:16px;
      border:0;
      background:var(--btn);
      color:#052317;
      font-weight:900;
      font-size:18px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:rgba(233,255,246,.10); color:var(--txt); border:1px solid rgba(233,255,246,.14)}
    .btn.warn{background:rgba(176,139,26,.95); color:#1f1600}
    .btn.danger{background:rgba(196,59,59,.95); color:#240606}
    .meta{
      margin-top:10px;
      display:flex;gap:8px;flex-wrap:wrap;
      color:rgba(233,255,246,.72);
      font-size:13px;
      align-items:center;
    }
    .pill{
      background:rgba(16,63,47,.85);
      border:1px solid rgba(233,255,246,.10);
      padding:8px 10px;border-radius:999px;
    }
    .table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius:14px;
      border:1px solid rgba(233,255,246,.10);
      margin-top:10px;
    }
    .table th, .table td{
      padding:10px 10px;
      border-bottom:1px solid rgba(233,255,246,.08);
      font-size:14px;
    }
    .table th{
      text-align:left;
      color:rgba(233,255,246,.8);
      background:rgba(0,0,0,.16);
      font-weight:800;
    }
    .table tr:last-child td{border-bottom:0}
    .right{text-align:right}
    .muted{color:rgba(233,255,246,.72)}
    .empty{
      padding:12px 10px;
      color:rgba(233,255,246,.65);
      border:1px dashed rgba(233,255,246,.14);
      border-radius:14px;
      background:rgba(0,0,0,.12);
      margin-top:10px;
    }
    .tiny{font-size:12px;color:rgba(233,255,246,.60)}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title"><span class="emoji">⛳️</span> Golf Log – Práctica</div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">

      <section class="card" id="capturaCard">
        <h2>Captura</h2>

        <div class="row">
          <div>
            <label for="clubSel">Palo</label>
            <select id="clubSel" autocomplete="off">
              <option value="">Selecciona</option>
              <option>Driver</option>
              <option>3W</option><option>5W</option>
              <option>3H</option><option>4H</option>
              <option>3I</option><option>4I</option><option>5I</option><option>6I</option><option>7I</option><option>8I</option><option>9I</option>
              <option>PW</option><option>GW</option><option>SW</option><option>LW</option>
              <option>Putter</option>
            </select>
          </div>

          <div>
            <label for="distIn">Distancia (m)</label>
            <input id="distIn" inputmode="numeric" pattern="[0-9]*" placeholder="Ej. 183" autocomplete="off" />
          </div>
        </div>

        <label>Dirección</label>
        <div class="seg" role="group" aria-label="Dirección">
          <button id="dirIzq" type="button" data-dir="Izq">Izq</button>
          <button id="dirCentro" type="button" data-dir="Centro" class="active">Centro</button>
          <button id="dirDer" type="button" data-dir="Der">Der</button>
        </div>

        <div class="actions">
          <button class="btn" id="guardarBtn" type="button">Guardar golpe</button>
          <button class="btn warn" id="deshacerBtn" type="button">Deshacer</button>
        </div>

        <div class="actions">
          <button class="btn secondary" id="borrarSesionBtn" type="button">Borrar sesión</button>
          <button class="btn danger" id="borrarTodoBtn" type="button">Borrar todo</button>
        </div>

        <div class="meta">
          <span class="pill" id="estadoPill">JS: activo ✓</span>
          <span class="pill" id="contPill">Tiros sesión: 0</span>
          <span class="tiny">B7.1 – estable iOS (sin SW)</span>
        </div>
      </section>

      <section class="card">
        <h2>Histórico (sesión)</h2>
        <div id="histWrap"></div>
      </section>

      <section class="card">
        <h2>Totales (sesión)</h2>
        <div id="totWrap"></div>
      </section>

    </div>
  </main>

<script>
(() => {
  "use strict";

  const LS_KEY = "golfLog_b7_sessionShots_v1";
  let shots = [];

  function load() {
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw){ shots = []; return; }
      const arr = JSON.parse(raw);
      shots = Array.isArray(arr) ? arr : [];
    } catch(e){
      shots = [];
    }
  }
  function save() {
    localStorage.setItem(LS_KEY, JSON.stringify(shots));
  }

  const $ = (id) => document.getElementById(id);

  const clubSel = $("clubSel");
  const distIn  = $("distIn");
  const guardarBtn = $("guardarBtn");
  const deshacerBtn = $("deshacerBtn");
  const borrarSesionBtn = $("borrarSesionBtn");
  const borrarTodoBtn = $("borrarTodoBtn");

  const dirBtns = [ $("dirIzq"), $("dirCentro"), $("dirDer") ];
  let dir = "Centro";

  const histWrap = $("histWrap");
  const totWrap = $("totWrap");
  const contPill = $("contPill");

  function setDir(newDir){
    dir = newDir;
    dirBtns.forEach(b => {
      const active = (b.dataset.dir === dir);
      b.classList.toggle("active", active);
      b.setAttribute("aria-pressed", active ? "true" : "false");
    });
  }

  const fmtTime = (ts) => {
    const d = new Date(ts);
    const hh = String(d.getHours()).padStart(2,"0");
    const mm = String(d.getMinutes()).padStart(2,"0");
    return `${hh}:${mm}`;
  };

  function render() {
    contPill.textContent = `Tiros sesión: ${shots.length}`;

    if(!shots.length){
      histWrap.innerHTML = `<div class="empty">Aún no hay tiros en esta sesión.</div>`;
    } else {
      const rows = shots.slice().reverse().map((s, idx) => {
        const n = shots.length - idx;
        return `<tr>
          <td class="muted">${n}</td>
          <td>${s.club}</td>
          <td class="right">${s.dist}</td>
          <td class="right">${s.dir}</td>
          <td class="right muted">${fmtTime(s.ts)}</td>
        </tr>`;
      }).join("");

      histWrap.innerHTML = `
        <table class="table" aria-label="Histórico sesión">
          <thead>
            <tr>
              <th>#</th>
              <th>Palo</th>
              <th class="right">m</th>
              <th class="right">Dir</th>
              <th class="right">Hora</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    }

    if(!shots.length){
      totWrap.innerHTML = `<div class="empty">Sin datos aún.</div>`;
    } else {
      const byClub = {};
      for(const s of shots){
        if(!byClub[s.club]) byClub[s.club] = {count:0,sum:0,avg:0};
        byClub[s.club].count++;
        byClub[s.club].sum += s.dist;
      }
      const clubs = Object.keys(byClub).sort((a,b) => {
        if(a==="Driver") return -1;
        if(b==="Driver") return 1;
        if(a==="Putter") return 1;
        if(b==="Putter") return -1;
        return a.localeCompare(b);
      });
      const rows = clubs.map(c => {
        const o = byClub[c];
        o.avg = Math.round((o.sum / o.count) * 10) / 10;
        return `<tr>
          <td>${c}</td>
          <td class="right">${o.count}</td>
          <td class="right">${o.avg}</td>
        </tr>`;
      }).join("");
      totWrap.innerHTML = `
        <table class="table" aria-label="Totales por palo (sesión)">
          <thead>
            <tr>
              <th>Palo</th>
              <th class="right">Tiros</th>
              <th class="right">Prom (m)</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    }
  }

  function readDistance(){
    const raw = (distIn.value || "").trim();
    if(!raw) return null;
    const n = Number(raw.replace(",", "."));
    if(!Number.isFinite(n)) return null;
    const dist = Math.round(n);
    if(dist <= 0 || dist > 500) return null;
    return dist;
  }

  function toast(msg){
    alert(msg);
  }

  function guardar(){
    const club = (clubSel.value || "").trim();
    if(!club){ toast("Selecciona un palo."); return; }

    const dist = readDistance();
    if(dist === null){ toast("Ingresa una distancia válida (1–500)."); return; }

    const shot = { ts: Date.now(), club, dist, dir };
    shots.push(shot);
    save();
    render();

    distIn.value = "";
    distIn.focus({preventScroll:true});
  }

  function deshacer(){
    if(!shots.length){ toast("No hay tiros que deshacer."); return; }
    shots.pop();
    save();
    render();
  }

  function borrarSesion(){
    if(!shots.length){ toast("La sesión ya está vacía."); return; }
    const ok = confirm("¿Borrar todos los tiros de esta sesión?");
    if(!ok) return;
    shots = [];
    save();
    render();
  }

  function borrarTodo(){
    const ok = confirm("⚠️ ¿Borrar TODO? (sesión y datos guardados)");
    if(!ok) return;
    localStorage.removeItem(LS_KEY);
    shots = [];
    render();
  }

  function bind(){
    dirBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        const d = btn.dataset.dir;
        if(d) setDir(d);
      }, {passive:true});
      btn.addEventListener("pointerup", () => {
        const d = btn.dataset.dir;
        if(d) setDir(d);
      });
    });

    guardarBtn.addEventListener("click", guardar);
    deshacerBtn.addEventListener("click", deshacer);
    borrarSesionBtn.addEventListener("click", borrarSesion);
    borrarTodoBtn.addEventListener("click", borrarTodo);

    distIn.addEventListener("keydown", (e) => {
      if(e.key === "Enter"){ e.preventDefault(); guardar(); }
    });
  }

  load();
  setDir("Centro");
  bind();
  render();
})();
</script>

</body>
</html>
