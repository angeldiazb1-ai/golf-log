<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Golf Log</title>

<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: #0f3d2e;
    color: #e8fff4;
  }
  h2 { margin: 16px 0 8px; }
  .card {
    background: #134b3a;
    border-radius: 14px;
    padding: 14px;
    margin: 12px;
  }
  button {
    border: none;
    border-radius: 12px;
    padding: 14px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
  }
  .btn-green { background: #3ddc97; color: #083a28; }
  .btn-yellow { background: #ffcc33; color: #3a2b00; }
  .btn-blue { background: #63a4ff; color: #0a2540; }
  .btn-gray { background: #3b4b45; color: #d0e6dc; }

  textarea {
    width: 100%;
    min-height: 160px;
    border-radius: 12px;
    border: 2px solid #2f7f62;
    background: #0d3024;
    color: #e8fff4;
    padding: 10px;
    font-family: monospace;
    font-size: 13px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 8px;
  }
  th, td {
    padding: 8px;
    border-bottom: 1px solid #2f7f62;
    text-align: left;
  }
  th { opacity: .85; }

  .row { display: flex; gap: 10px; }
  .row button { flex: 1; }

  .pill {
    display: inline-block;
    padding: 6px 10px;
    border-radius: 999px;
    font-size: 13px;
    font-weight: 600;
  }
  .pill-ok { background: #2ecc71; color: #083a28; }
  .pill-warn { background: #e74c3c; color: white; }

  .bar {
    height: 14px;
    border-radius: 7px;
    background: linear-gradient(to right, #e74c3c 0%, #3ddc97 50%, #e74c3c 100%);
    margin: 8px 0;
  }
</style>
</head>

<body>

<div class="card">
  <h2>Distancia (m)</h2>
  <input id="distInput" type="number" placeholder="Ej. 220" style="width:100%;padding:14px;border-radius:12px;border:none;font-size:16px;">
  <div class="row" style="margin-top:10px;">
    <button id="guardarBtn" class="btn-green">Guardar golpe</button>
    <button id="deshacerBtn" class="btn-yellow">Deshacer</button>
  </div>
</div>

<div class="card">
  <h2>Historial (Sesi√≥n)</h2>
  <button id="nuevaSesionBtn" class="btn-blue" style="width:100%;">Nueva sesi√≥n</button>
  <table id="tablaSesion"></table>
</div>

<div class="card">
  <h2>Dispersi√≥n (Sesi√≥n)</h2>
  <div id="dispersion"></div>
  <div class="bar"></div>
  <div><strong>Sesgo:</strong> <span id="sesgo">‚Äî</span></div>
</div>

<div class="card">
  <h2>Alcances por palo (Totales)</h2>
  <div><strong>Base:</strong> solo tiros con distancia (range)</div>
  <table id="tablaAlcances"></table>
</div>

<div class="card">
  <h2>Respaldo (JSON)</h2>
  <div class="pill pill-ok">Exporta antes de actualizar</div>
  <textarea id="backupJson" placeholder="Aqu√≠ aparecer√° tu respaldo o pega un JSON para importar"></textarea>
  <div class="row" style="margin-top:10px;">
    <button id="exportarBtn" class="btn-green">Exportar</button>
    <button id="copiarBtn" class="btn-yellow">Copiar</button>
  </div>
  <div class="row" style="margin-top:10px;">
    <button id="importarBtn" class="btn-blue">Importar</button>
    <button id="limpiarBtn" class="btn-gray">Limpiar</button>
  </div>
  <div id="estadoBackup" style="margin-top:8px;opacity:.85;">Estado: ‚Äî</div>
</div>

<script>
let state = { sessionId: 1, tiros: [] };

function save(){ localStorage.setItem("golf-log", JSON.stringify(state)); }
function load(){ const r = localStorage.getItem("golf-log"); if(r) state = JSON.parse(r); }

function guardarTiro(){
  const i = document.getElementById("distInput");
  const m = Number(i.value);
  if(!m) return;
  state.tiros.push({ session: state.sessionId, palo:"Driver", modo:"range", dir:"Centro", m });
  i.value = "";
  save(); renderAll();
}
function deshacerUltimo(){ state.tiros.pop(); save(); renderAll(); }
function nuevaSesion(){ state.sessionId++; save(); renderAll(); }

function renderSesion(){
  const t = document.getElementById("tablaSesion");
  const rows = state.tiros.filter(x=>x.session===state.sessionId).slice().reverse()
    .map((x,i)=>`<tr><td>${i+1}</td><td>${x.modo}</td><td>${x.palo}</td></tr>`).join("");
  t.innerHTML = "<tr><th>#</th><th>Modo</th><th>Palo</th></tr>"+rows;
}
function renderDispersion(){
  const d = document.getElementById("dispersion");
  const s = state.tiros.filter(x=>x.session===state.sessionId);
  const n = s.length||1;
  const c=s.filter(x=>x.dir==="Centro").length,l=s.filter(x=>x.dir==="Izq").length,r=s.filter(x=>x.dir==="Der").length;
  d.innerHTML=`<div>Izq ${Math.round(l/n*100)}% (${l})</div><div>Centro ${Math.round(c/n*100)}% (${c})</div><div>Der ${Math.round(r/n*100)}% (${r})</div>`;
  document.getElementById("sesgo").textContent = l>r?"Izquierda":r>l?"Derecha":"Neutral";
}
function renderAlcances(){
  const t=document.getElementById("tablaAlcances");
  const a=state.tiros.filter(x=>x.m && x.modo==="range").map(x=>x.m);
  if(!a.length){ t.innerHTML="<tr><td>A√∫n no hay tiros con distancia</td></tr>"; return; }
  const min=Math.min(...a),max=Math.max(...a),avg=Math.round(a.reduce((s,v)=>s+v,0)/a.length);
  t.innerHTML=`<tr><th>Palo</th><th>n</th><th>M√≠n</th><th>Prom</th><th>M√°x</th></tr><tr><td>Driver</td><td>${a.length}</td><td>${min}</td><td>${avg}</td><td>${max}</td></tr>`;
}
function renderAll(){ renderSesion(); renderDispersion(); renderAlcances(); }

function setupBackup(){
  const ta=document.getElementById("backupJson"), st=document.getElementById("estadoBackup");
  document.getElementById("exportarBtn").onclick=()=>{ ta.value=JSON.stringify({__app:"golf-log",__schema:1,exportedAt:new Date().toISOString(),state},null,2); st.textContent="Estado: Exportado ‚úÖ"; };
  document.getElementById("copiarBtn").onclick=()=>{ ta.select(); document.execCommand("copy"); st.textContent="Estado: Copiado üìã"; };
  document.getElementById("importarBtn").onclick=()=>{ try{ const d=JSON.parse(ta.value); if(!d.state) throw 0; state=d.state; save(); renderAll(); st.textContent="Estado: Importado ‚úÖ"; }catch{ st.textContent="Estado: JSON inv√°lido ‚ùå"; } };
  document.getElementById("limpiarBtn").onclick=()=>{ ta.value=""; st.textContent="Estado: ‚Äî"; };
}

load(); renderAll(); setupBackup();
document.getElementById("guardarBtn").onclick=guardarTiro;
document.getElementById("deshacerBtn").onclick=deshacerUltimo;
document.getElementById("nuevaSesionBtn").onclick=nuevaSesion;
</script>

</body>
</html>
