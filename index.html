<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#0b3a2e" />
  <title>Golf Log – Práctica</title>

  <style>
    :root{
      --bg:#073228;
      --panel:#0b3a2e;
      --card:#0d4637;
      --text:#e9fff6;
      --muted:#b9e7d6;
      --btn:#1c9a62;
      --btn2:#15794d;
      --warn:#b38b00;
      --danger:#d9534f;
      --shadow: 0 10px 30px rgba(0,0,0,.25);
      --radius: 22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 50% -150px, rgba(255,255,255,.12), transparent 60%),
                  linear-gradient(180deg, #063025, #062a22);
      color:var(--text);
      font-family: -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      padding: env(safe-area-inset-top) 14px env(safe-area-inset-bottom) 14px;
    }
    header{
      display:flex; align-items:center; justify-content:center;
      padding: 18px 0 14px;
      position: sticky;
      top: 0;
      background: linear-gradient(180deg, rgba(6,42,34,.92), rgba(6,42,34,.65));
      backdrop-filter: blur(8px);
      z-index: 10;
    }
    header h1{
      margin:0;
      font-size: 22px;
      letter-spacing:.2px;
      font-weight: 800;
      display:flex;
      align-items:center;
      gap:10px;
    }
    header .dot{
      width:10px; height:10px; border-radius:999px;
      background: #43e29f;
      box-shadow: 0 0 0 6px rgba(67,226,159,.12);
    }

    .wrap{max-width: 520px; margin: 0 auto;}
    .card{
      background: rgba(13,70,55,.92);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      margin: 14px 0;
    }

    label{
      display:block;
      font-size: 14px;
      color: var(--muted);
      margin: 10px 0 8px;
      font-weight: 700;
      letter-spacing: .2px;
    }
    select, input{
      width:100%;
      height:56px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      color: var(--text);
      padding: 0 14px;
      font-size: 18px;
      outline: none;
      -webkit-appearance: none;
      appearance: none;
    }
    input::placeholder{color: rgba(233,255,246,.45)}
    .row{display:flex; gap:10px}
    .row > *{flex:1}

    .seg{
      display:flex;
      gap:10px;
      margin-top: 8px;
    }
    .seg button{
      flex:1;
      height:56px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      color: rgba(233,255,246,.55);
      font-size: 18px;
      font-weight: 800;
      letter-spacing: .2px;
      box-shadow: 0 8px 20px rgba(0,0,0,.18);
      /* iOS tap */
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
    }
    .seg button.active{
      background: rgba(28,154,98,.92);
      border-color: rgba(67,226,159,.35);
      color: #062a22;
    }

    .actions{
      display:flex;
      gap:12px;
      margin-top: 14px;
    }
    .actions button{
      flex:1;
      height:64px;
      border-radius: 18px;
      border: none;
      font-size: 20px;
      font-weight: 900;
      letter-spacing:.2px;
      color: #062a22;
      background: linear-gradient(180deg, var(--btn), var(--btn2));
      box-shadow: 0 12px 28px rgba(0,0,0,.25);
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      user-select: none;
      -webkit-user-select: none;
    }
    .actions button.secondary{
      background: linear-gradient(180deg, #c9a200, #a88400);
      color: #1f1a00;
    }
    .actions button.danger{
      background: linear-gradient(180deg, #ff6a66, #d9534f);
      color: #2b0908;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.08);
      color: rgba(233,255,246,.85);
      font-weight: 800;
      margin-top: 12px;
      font-size: 13px;
    }
    .muted{color: rgba(233,255,246,.65)}

    h2{
      margin: 4px 0 10px;
      font-size: 22px;
      font-weight: 950;
      letter-spacing:.2px;
    }
    ul{
      list-style: none;
      padding: 0;
      margin: 10px 0 0;
    }
    li{
      padding: 10px 12px;
      margin: 8px 0;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(0,0,0,.16);
      font-weight: 800;
      letter-spacing:.2px;
    }
    .small{
      font-size: 12px;
      opacity:.8;
      margin-top: 8px;
      line-height: 1.35;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1><span class="dot"></span> Golf Log – Práctica</h1>
    </header>

    <section class="card">
      <label for="clubSel">Palo</label>
      <select id="clubSel">
        <option value="">Selecciona</option>
        <option>Driver</option>
        <option>3W</option>
        <option>5W</option>
        <option>3H</option>
        <option>4H</option>
        <option>4I</option>
        <option>5I</option>
        <option>6I</option>
        <option>7I</option>
        <option>8I</option>
        <option>9I</option>
        <option>PW</option>
        <option>GW</option>
        <option>SW56</option>
        <option>LW</option>
        <option>Putter</option>
      </select>

      <label for="distInput">Distancia (m)</label>
      <input id="distInput" inputmode="numeric" placeholder="Ej. 183" />

      <label>Dirección</label>
      <div class="seg" role="group" aria-label="Dirección">
        <button id="dirIzqBtn" type="button" data-dir="Izq">Izq</button>
        <button id="dirCentroBtn" type="button" data-dir="Centro" class="active">Centro</button>
        <button id="dirDerBtn" type="button" data-dir="Der">Der</button>
      </div>

      <div class="actions">
        <button id="guardarBtn" type="button">Guardar golpe</button>
        <button id="deshacerBtn" type="button" class="secondary">Deshacer</button>
      </div>

      <div class="pill" id="statusPill">✅ JS activo · <span class="muted" id="versionTxt"></span></div>
      <div class="small muted" id="lastTxt">Último: —</div>
    </section>

    <section class="card">
      <h2>Histórico</h2>
      <div class="actions">
        <button id="borrarTodoBtn" type="button" class="danger">Borrar histórico</button>
      </div>
      <ul id="histList"></ul>
      <div class="small muted">Guardado local en este iPhone (localStorage). Sin Service Worker.</div>
    </section>
  </div>

  <script>
    (function(){
      "use strict";

      const APP_VERSION = "B7.0-base-iOS-sinSW";
      const LS_KEY = "golfLog_shots_v7";

      // --- helpers
      const $ = (id) => document.getElementById(id);
      const safeParse = (s, fallback) => { try { return JSON.parse(s); } catch { return fallback; } };

      // --- state
      let shots = safeParse(localStorage.getItem(LS_KEY), []);
      if (!Array.isArray(shots)) shots = [];
      let currentDir = "Centro";

      // --- DOM
      const clubSel = $("clubSel");
      const distInput = $("distInput");
      const lastTxt = $("lastTxt");
      const histList = $("histList");
      const versionTxt = $("versionTxt");

      const dirButtons = [
        $("dirIzqBtn"),
        $("dirCentroBtn"),
        $("dirDerBtn")
      ];

      const guardarBtn = $("guardarBtn");
      const deshacerBtn = $("deshacerBtn");
      const borrarTodoBtn = $("borrarTodoBtn");

      function persist(){
        localStorage.setItem(LS_KEY, JSON.stringify(shots));
      }

      function fmtShot(s){
        return `${s.club} – ${s.dist} m – ${s.dir}`;
      }

      function render(){
        // último
        if (shots.length > 0){
          lastTxt.textContent = "Último: " + fmtShot(shots[shots.length - 1]);
        } else {
          lastTxt.textContent = "Último: —";
        }

        // lista (últimos 30)
        histList.innerHTML = "";
        const last = shots.slice(-30).reverse();
        for (const s of last){
          const li = document.createElement("li");
          li.textContent = fmtShot(s);
          histList.appendChild(li);
        }
      }

      function setDir(dir){
        currentDir = dir;
        for (const b of dirButtons){
          b.classList.toggle("active", b.dataset.dir === dir);
        }
      }

      function sanitizeDist(v){
        // solo dígitos, máximo 3-4
        const clean = String(v || "").replace(/[^\d]/g, "").slice(0, 4);
        return clean;
      }

      function handleSave(){
        const club = clubSel.value.trim();
        const dist = sanitizeDist(distInput.value);

        if (!club){
          alert("Selecciona un palo.");
          return;
        }
        if (!dist || Number(dist) <= 0){
          alert("Ingresa una distancia válida.");
          return;
        }

        shots.push({
          club,
          dist: Number(dist),
          dir: currentDir,
          ts: Date.now()
        });
        persist();
        render();

        // mantener palo y dirección, limpiar solo distancia para velocidad
        distInput.value = "";
        distInput.focus({ preventScroll: true });
      }

      function handleUndo(){
        if (shots.length === 0){
          alert("No hay golpes para deshacer.");
          return;
        }
        shots.pop();
        persist();
        render();
      }

      function handleClearAll(){
        if (!confirm("¿Borrar TODO el histórico?")){
          return;
        }
        shots = [];
        persist();
        render();
      }

      // --- iOS-safe binding
      function bindTap(el, fn){
        // En iOS Safari a veces click se “pierde” con overlays / fast taps.
        // Usamos pointerdown si existe, si no touchstart + click.
        const opts = { passive: false };

        const wrapped = (e) => {
          // importante para iOS: evitar que el evento “muera” por scroll/tap highlight
          try { e.preventDefault(); } catch {}
          try { e.stopPropagation(); } catch {}
          fn();
        };

        if (window.PointerEvent){
          el.addEventListener("pointerdown", wrapped, opts);
        } else {
          el.addEventListener("touchstart", wrapped, opts);
          el.addEventListener("click", wrapped, false);
        }
      }

      function init(){
        versionTxt.textContent = APP_VERSION;

        // dirección
        for (const b of dirButtons){
          bindTap(b, () => setDir(b.dataset.dir));
        }
        setDir("Centro");

        // acciones
        bindTap(guardarBtn, handleSave);
        bindTap(deshacerBtn, handleUndo);
        bindTap(borrarTodoBtn, handleClearAll);

        // input: limpiar caracteres raros
        distInput.addEventListener("input", () => {
          const clean = sanitizeDist(distInput.value);
          if (distInput.value !== clean) distInput.value = clean;
        }, { passive: true });

        render();
      }

      if (document.readyState === "loading"){
        document.addEventListener("DOMContentLoaded", init, { once: true });
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
